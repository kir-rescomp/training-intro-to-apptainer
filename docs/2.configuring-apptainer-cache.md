# 2. Understanding and Configuring Apptainer Cache and Temporary Directories

## Why This Matters
By default, Apptainer will attempt to use your home directory for all operations, creating a hidden directory `~/.apptainer` for this purpose. Since home directories are limited to 20GB, we recommend redirecting these operations to the nobackup filesystem to avoid quota issues.


## What Are These Directories?

### `APPTAINER_CACHEDIR` (Local Cache Directory)

This is where Apptainer stores downloaded container images, layers, and other reusable components. When you pull a container image from a registry (like Docker Hub or Sylabs Cloud), Apptainer downloads and caches the image layers here. The cache helps speed up subsequent operations by avoiding redundant downloads. Over time, this directory can grow significantly, especially if you work with multiple large container images.

### `APPTAINER_TMPDIR` (Temporary Directory)
This directory is used for temporary files during container build and execution operations. Apptainer uses this space for:

- Unpacking and assembling container layers
- Storing temporary files during container builds
- Managing overlay filesystems when running containers
- Other transient operations that require scratch space

These temporary files are typically cleaned up after operations complete, but the directory can require substantial space during active operations, particularly when building large containers.

## Setting Up Your Environment


To configure Apptainer to use  filesystem other than your home directory, set the following environment variables before running Apptainer.

* We recommend using `scratch` file system (`/gpfs3/well/kir/scratch/group`) for both cache and temporary. 

!!! terminal "code"
    1. create a dedicated directory for yourself on scrach ( make sure to replace `group` with your research group)
    ```bash
    mkdir -p /gpfs3/well/kir/scratch/group/$USER_apptainer_cache
    ```
    ```bash
    export APPTAINER_CACHEDIR="/gpfs3/well/kir/scratch/group/$USER_apptainer_cache"
    export APPTAINER_TMPDIR=${APPTAINER_CACHEDIR}
    ```

!!! tent-arrow-down "Making Changes Permanent"

    We recommend adding these environment variables to your `~/.bashrc` file so they're automatically set for all future sessions. This ensures consistent behavior and prevents accidentally filling up your home directory quota.

    ```bash
    echo 'export APPTAINER_CACHEDIR="/gpfs3/well/kir/scratch/group/$USER_apptainer_cache"' >> ~/.bashrc
    echo 'export APPTAINER_TMPDIR=${APPTAINER_CACHEDIR}' >> ~/.bashrc
    ```